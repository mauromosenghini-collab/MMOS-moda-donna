{% extends "base.html" %}
{% load static %}
{# Carica l'estensione Crispy Forms per una formattazione automatica professionale dei moduli #}
{% load crispy_forms_tags %}

{% block title %}Checkout{% endblock %}

{% block content %}
<h1>Checkout</h1>
<div class="row">
    <div class="col-md-6">
        <h3>Dettagli ordine</h3>
        {# Il form punta alla stessa URL (order_create) e invia i dati tramite POST #}
        <form method="post">
            {% csrf_token %}
            {# Campi dati spedizione #}
            <h5>Informazioni di spedizione</h5>
            <div class="mb-3">
                <label for="{{ form.first_name.id_for_label }}" class="form-label">{{ form.first_name.label }}</label>
                {{ form.first_name }}
            </div>
            <div class="mb-3">
                <label for="{{ form.last_name.id_for_label }}" class="form-label">{{ form.last_name.label }}</label>
                {{ form.last_name }}
            </div>
            <div class="mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
                {{ form.email }}
            </div>
            <div class="mb-3">
                <label for="{{ form.address.id_for_label }}" class="form-label">{{ form.address.label }}</label>
                {{ form.address }}
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.postal_code.id_for_label }}" class="form-label">{{ form.postal_code.label }}</label>
                    {{ form.postal_code }}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.city.id_for_label }}" class="form-label">{{ form.city.label }}</label>
                    {{ form.city }}
                </div>
            </div>
            
            {# Sezione metodo di pagamento #}
            <h5 class="mt-4">Metodo di pagamento</h5>
            <div class="card p-3 mb-3">
                {% for value, label in form.payment_method.field.choices %}
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="payment_method" id="payment_{{ value }}" value="{{ value }}" 
                            {% if form.payment_method.value == value %}checked{% endif %}>
                        <label class="form-check-label" for="payment_{{ value }}">
                            <strong>{{ label }}</strong>
                        </label>
                    </div>
                {% endfor %}
            </div>
            
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-check-circle"></i> Conferma ordine
            </button>
        </form>
    </div>
    <div class="col-md-6">
        <h3>Riepilogo carrello</h3>
        <div class="card">
            <div class="card-body">
                {# Lista pulita dei prodotti che l'utente sta per acquistare #}
                <ul class="list-group list-group-flush">
                    {% for item in cart %}
                        <li class="list-group-item d-flex justify-content-between">
                            {# Mostra nome, quantità e prezzo totale per riga #}
                            <span>{{ item.product.name }} x {{ item.quantity }}</span>
                            <span>{{ item.total_price }} €</span>
                        </li>
                    {% endfor %}
                </ul>
                <div class="card-footer">
                    {# Calcola il totale complessivo usando il metodo definito nella classe Cart #}
                    <strong>Totale: {{ cart.get_total_price }} €</strong>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
